{% extends 'base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block title %}My Account{% endblock %}

{% block content %}
<div class="profile-container">

    <div class="tabs">
        <button class="tab active" data-tab="info">ðŸ‘¤ Profile Info</button>
        <button class="tab" data-tab="orders">ðŸ§¾ My Orders</button>
    </div>

    <div class="tab-content active" id="info">
        <h2>Personal Information</h2>

        <form method="post" action="" class="profile-form">
            {% csrf_token %}
            <div class="form-group">
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ user.fname }}">
            </div>

            <div class="form-group">
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ user.lname }}">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" value="{{ user.email }}">
            </div>

            <div class="form-group">
                <label>Phone</label>
                <input type="text" name="phone" value="{{ user.phone }}">
            </div>

            <div class="form-group">
                <label>Sex</label>
                <select name="sex">
                    <option value="m" {% if user.sex == 'm' %}selected{% endif %}>Male</option>
                    <option value="f" {% if user.sex == 'f' %}selected{% endif %}>Female</option>
                    <option value="o" {% if user.sex == 'o' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Birthday</label>
                <input type="date" name="birthday" value="{{ user.birthday|date:'Y-m-d' }}">
            </div>

            <div class="form-group">
                <label>Client Type</label>
                <select name="client_type">
                    <option value="cli" {% if user.client_type == 'cli' %}selected{% endif %}>Client</option>
                    <option value="emp" {% if user.client_type == 'emp' %}selected{% endif %}>Employee</option>
                    <option value="pen" {% if user.client_type == 'pen' %}selected{% endif %}>Pensioner</option>
                    <option value="nd" {% if user.client_type == 'nd' %}selected{% endif %}>Not Defined</option>
                    <option value="sk" {% if user.client_type == 'sk' %}selected{% endif %}>Schoolkid</option>
                    <option value="st" {% if user.client_type == 'st' %}selected{% endif %}>Student</option>
                </select>
            </div>

            <div class="button-group">
                <button type="submit" class="save-btn">ðŸ’¾ Save Changes</button>
                <a href="{% url 'logout' %}" class="exit-btn">ðŸšª Exit</a>
            </div>
        </form>
    </div>

    <div class="tab-content" id="orders">
        <h2>My Orders</h2>
        {% if orders %}
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id|slice:":8" }}</td>
                        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ order.get_status_display }}</td>
                        <td>{{ order.total_text }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>You havenâ€™t made any orders yet.</p>
        {% endif %}
    </div>

</div>

<script>
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
    });
});
</script>
{% endblock %}
