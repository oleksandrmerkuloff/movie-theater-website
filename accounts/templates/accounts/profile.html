{% extends 'base.html' %}
{% load static %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-tabs">
        <button class="tab-button active" data-tab="info">üë§ Profile Info</button>
        <button class="tab-button" data-tab="orders">üì¶ My Orders</button>
    </div>

    <!-- Profile Info Section -->
    <div id="info" class="tab-content active">
        <form id="profile-form" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label>First Name</label>
                <input type="text" name="first_name" value="{{ user.first_name }}" required>
            </div>
            <div class="form-group">
                <label>Last Name</label>
                <input type="text" name="last_name" value="{{ user.last_name }}" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" value="{{ user.email }}" required>
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="tel" name="phone" value="{{ profile.phone }}">
            </div>
            <div class="form-group">
                <label>Sex</label>
                <select name="sex">
                    <option value="m" {% if profile.sex == 'm' %}selected{% endif %}>Male</option>
                    <option value="f" {% if profile.sex == 'f' %}selected{% endif %}>Female</option>
                    <option value="o" {% if profile.sex == 'o' %}selected{% endif %}>Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Birthday</label>
                <input type="date" name="birthday" value="{{ profile.birthday|date:'Y-m-d' }}">
            </div>
            <div class="form-group">
                <label>Client Type</label>
                <select name="client_type">
                    <option value="cli" {% if profile.client_type == 'cli' %}selected{% endif %}>Client</option>
                    <option value="emp" {% if profile.client_type == 'emp' %}selected{% endif %}>Employee</option>
                    <option value="pen" {% if profile.client_type == 'pen' %}selected{% endif %}>Pensioner</option>
                    <option value="nd" {% if profile.client_type == 'nd' %}selected{% endif %}>Not Defined</option>
                    <option value="sk" {% if profile.client_type == 'sk' %}selected{% endif %}>Schoolkid</option>
                    <option value="st" {% if profile.client_type == 'st' %}selected{% endif %}>Student</option>
                </select>
            </div>

            <div class="form-actions">
                <button type="submit" class="save-btn">üíæ Save</button>
                <button type="button" class="cancel-btn" onclick="window.location.href='/'">‚ùå Exit</button>
            </div>
        </form>
    </div>

    <!-- Orders Section -->
    <div id="orders" class="tab-content">
        {% if orders %}
        <div class="orders-list">
            {% for order in orders %}
            <div class="order-card">
                <div class="order-header">
                    <span>üßæ Order #{{ order.id }}</span>
                    <span>{{ order.date|date:"d M Y H:i" }}</span>
                </div>
                <div class="order-items">
                    {% for item in order.items.all %}
                    <div class="order-item">
                        <span>{{ item.product.name }} √ó {{ item.quantity }}</span>
                        <span>‚Ç¥{{ item.total_price }}</span>
                    </div>
                    {% endfor %}
                </div>
                <div class="order-footer">
                    <strong>Total:</strong> ‚Ç¥{{ order.total }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No orders yet.</p>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabs = document.querySelectorAll('.tab-content');

    tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            tabButtons.forEach(b => b.classList.remove('active'));
            tabs.forEach(t => t.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.dataset.tab).classList.add('active');
        });
    });
});
</script>
{% endblock %}
