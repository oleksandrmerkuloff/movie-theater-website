{% extends 'base.html' %}
{% load static %}

{% block style %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock %}

{% block title %}My Account{% endblock %}

{% block content %}
<div class="profile-container">

    <div class="tabs">
        <button class="tab active" data-tab="info">Profile Info</button>
        <button class="tab" data-tab="orders">My Orders</button>
    </div>

    <div class="tab-content active" id="info">
        <h2>Personal Information</h2>

        <form method="post" class="profile-form">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="form-group">
                <label>{{ form.fname.label }}</label>
                {{ form.fname }}
                {% if form.fname.errors %}<span class="error">{{ form.fname.errors|join:", " }}</span>{% endif %}
            </div>

            <div class="form-group">
                <label>{{ form.lname.label }}</label>
                {{ form.lname }}
                {% if form.lname.errors %}<span class="error">{{ form.lname.errors|join:", " }}</span>{% endif %}
            </div>

            <div class="form-group">
                <label>{{ form.email.label }}</label>
                {{ form.email }}
                {% if form.email.errors %}<span class="error">{{ form.email.errors|join:", " }}</span>{% endif %}
            </div>

            <div class="form-group">
                <label>{{ form.phone.label }}</label>
                {{ form.phone }}
                {% if form.phone.errors %}<span class="error">{{ form.phone.errors|join:", " }}</span>{% endif %}
            </div>

            <div class="form-group">
                <label>{{ form.sex.label }}</label>
                {{ form.sex }}
            </div>

            <div class="form-group">
                <label>{{ form.birthday.label }}</label>
                {{ form.birthday }}
            </div>

            <div class="form-group">
                <label>{{ form.client_type.label }}</label>
                {{ form.client_type }}
            </div>

            <div class="button-group">
                <button type="submit" class="save-btn">Save Changes</button>
                <a href="{% url 'logout' %}" class="exit-btn">Exit</a>
            </div>
        </form>
    </div>

    <div class="tab-content" id="orders">
        <h2>My Orders</h2>
        {% if orders %}
            <table class="orders-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id|slice:":8" }}</td>
                        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ order.get_status_display }}</td>
                        <td>{{ order.total_text }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>You havenâ€™t made any orders yet.</p>
        {% endif %}
    </div>

</div>

<script>
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
    });
});
</script>
{% endblock %}
